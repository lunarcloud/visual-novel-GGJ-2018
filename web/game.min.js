/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Object.defineProperty(Array.prototype,'erase',{value:function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;}});Object.defineProperty(Array.prototype,'random',{value:function(item){return this[Math.floor(Math.random()*this.length)];}});Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.24',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ig.System.SCALE.CRISP(canvas,ctx);var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw("Unresolved (or circular?) dependencies. "+"Most likely there's a name/path mismatch for one of the listed modules "+"or a previous syntax error prevents a module from loading:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||/mobile/i.test(navigator.userAgent);ig.ua.touchDevice=(('ontouchstart'in window)||(window.navigator.msMaxTouchPoints));},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;var lastClassId=0;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;Class.classId=prototype.classId=++lastClassId;return Class;};if(window.ImpactMixin){ig.merge(ig,window.ImpactMixin);}})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var origPixels=ig.getImagePixels(this.data,0,0,this.width,this.height);var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]<128&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}
if(ig.Sound.enabled&&ig.Sound.useWebAudio){this.audioContext=new AudioContext();this.boundWebAudioUnlock=this.unlockWebAudio.bind(this);document.addEventListener('touchstart',this.boundWebAudioUnlock,false);}},unlockWebAudio:function(){document.removeEventListener('touchstart',this.boundWebAudioUnlock,false);var buffer=this.audioContext.createBuffer(1,1,22050);var source=this.audioContext.createBufferSource();source.buffer=buffer;source.connect(this.audioContext.destination);source.start(0);},load:function(path,multiChannel,loadCallback){if(multiChannel&&ig.Sound.useWebAudio){return this.loadWebAudio(path,multiChannel,loadCallback);}
else{return this.loadHTML5Audio(path,multiChannel,loadCallback);}},loadWebAudio:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){return this.clips[path];}
var audioSource=new ig.Sound.WebAudioSource()
this.clips[path]=audioSource;var request=new XMLHttpRequest();request.open('GET',realPath,true);request.responseType='arraybuffer';var that=this;request.onload=function(ev){that.audioContext.decodeAudioData(request.response,function(buffer){audioSource.buffer=buffer;loadCallback(path,true,ev);},function(ev){loadCallback(path,false,ev);});};request.onerror=function(ev){loadCallback(path,false,ev);};request.send();return audioSource;},loadHTML5Audio:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(this.clips[path]instanceof ig.Sound.WebAudioSource){return this.clips[path];}
if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){if(ig.ua.mobile){setTimeout(function(){loadCallback(path,true,null);},0);}
else{clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];if(channels&&channels instanceof ig.Sound.WebAudioSource){return channels;}
for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);if(track instanceof ig.Sound.WebAudioSource){ig.system.stopRunLoop();throw("Sound '"+path+"' loaded as Multichannel but used for Music. "+"Set the multiChannel param to false when loading, e.g.: new ig.Sound(path, false)");}
track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,_loop:false,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});this.load();},getLooping:function(){return this._loop;},setLooping:function(loop){this._loop=loop;if(this.currentClip){this.currentClip.loop=loop;}},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.loop=this._loop;this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.WebAudioSource=ig.Class.extend({sources:[],gain:null,buffer:null,_loop:false,init:function(){this.gain=ig.soundManager.audioContext.createGain();this.gain.connect(ig.soundManager.audioContext.destination);Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});},play:function(){if(!this.buffer){return;}
var source=ig.soundManager.audioContext.createBufferSource();source.buffer=this.buffer;source.connect(this.gain);source.loop=this._loop;var that=this;this.sources.push(source);source.onended=function(){that.sources.erase(source);}
source.start(0);},pause:function(){for(var i=0;i<this.sources.length;i++){try{this.sources[i].stop();}catch(err){}}},getLooping:function(){return this._loop;},setLooping:function(loop){this._loop=loop;for(var i=0;i<this.sources.length;i++){this.sources[i].loop=loop;}},getVolume:function(){return this.gain.gain.value;},setVolume:function(volume){this.gain.gain.value=volume;}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;ig.normalizeVendorAttribute(window,'AudioContext');ig.Sound.useWebAudio=!!window.AudioContext&&!window.nwf;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){context.imageSmoothingEnabled=false;canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){context.imageSmoothingEnabled=true;canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,{passive:true});ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,{passive:true});ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);if(ig.ua.touchDevice){ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('MSPointerDown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('MSPointerUp',this.keyup.bind(this),false);ig.system.canvas.addEventListener('MSPointerMove',this.mousemove.bind(this),false);ig.system.canvas.style.msTouchAction='none';}},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
this.isUsingAccelerometer=true;window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.touches?event.touches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(code<0&&!ig.ua.mobile){window.focus();}
if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.preventDefault();}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);element.addEventListener('MSPointerDown',function(ev){that.touchStart(ev,action);},false);element.addEventListener('MSPointerUp',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return!!this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/plugins/impact-splash-loader.js
ig.baked=true;ig.module('plugins.impact-splash-loader').requires('impact.loader').defines(function(){ig.ImpactSplashLoader=ig.Loader.extend({endTime:0,fadeToBlackTime:200,fadeToGameTime:800,logoWidth:340,logoHeight:120,end:function(){this.parent();this.endTime=Date.now();ig.system.setDelegate(this);},run:function(){var t=Date.now()-this.endTime;var alpha=1;if(t<this.fadeToBlackTime){this.draw();alpha=t.map(0,this.fadeToBlackTime,0,1);}
else if(t<this.fadeToGameTime){ig.game.run();alpha=t.map(this.fadeToBlackTime,this.fadeToGameTime,1,0);}
else{ig.system.setDelegate(ig.game);return;}
ig.system.context.fillStyle='rgba(0,0,0,'+alpha+')';ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var ctx=ig.system.context;var w=ig.system.realWidth;var h=ig.system.realHeight;var scale=w/this.logoWidth/3;var center=(w-this.logoWidth*scale)/2;ctx.fillStyle='rgba(0,0,0,0.8)';ctx.fillRect(0,0,w,h);ctx.fillStyle='rgb(128,128,128)';ctx.textAlign='right';ctx.font=(20*scale)+'px Arial';ctx.fillText('http://impactjs.com',w-10,h-10);ctx.textAlign='left';ctx.save();ctx.translate(center,h/2.5);ctx.scale(scale,scale);ctx.lineWidth='3';ctx.strokeStyle='rgb(255,255,255)';ctx.strokeRect(25,this.logoHeight+40,300,20);ctx.fillStyle='rgb(255,255,255)';ctx.fillRect(30,this.logoHeight+45,290*this._drawStatus,10);this.drawPaths('rgb(255,255,255)',ig.ImpactSplashLoader.PATHS_IMPACT);var comet=ig.ImpactSplashLoader.PATHS_COMET;comet[5][0]=3-Math.random()*this._drawStatus*7;comet[5][1]=3-Math.random()*this._drawStatus*10;comet[7][0]=29.5-Math.random()*this._drawStatus*10;comet[7][1]=40.4-Math.random()*this._drawStatus*10;comet[9][0]=16.1-Math.random()*this._drawStatus*10;comet[9][1]=36.1-Math.random()*this._drawStatus*5;ctx.translate(-Math.random()*this._drawStatus*7,-Math.random()*this._drawStatus*5);this.drawPaths('rgb(243,120,31)',comet);ctx.restore();},drawPaths:function(color,paths){var ctx=ig.system.context;ctx.fillStyle=color;for(var i=0;i<paths.length;i+=2){ctx[ig.ImpactSplashLoader.OPS[paths[i]]].apply(ctx,paths[i+1]);}}});ig.ImpactSplashLoader.OPS={bp:'beginPath',cp:'closePath',f:'fill',m:'moveTo',l:'lineTo',bc:'bezierCurveTo'};ig.ImpactSplashLoader.PATHS_COMET=['bp',[],'m',[85.1,58.3],'l',[0.0,0.0],'l',[29.5,40.4],'l',[16.1,36.1],'l',[54.6,91.6],'bc',[65.2,106.1,83.4,106.7,93.8,95.7],'bc',[103.9,84.9,98.6,67.6,85.1,58.3],'cp',[],'m',[76.0,94.3],'bc',[68.5,94.3,62.5,88.2,62.5,80.8],'bc',[62.5,73.3,68.5,67.2,76.0,67.2],'bc',[83.5,67.2,89.6,73.3,89.6,80.8],'bc',[89.6,88.2,83.5,94.3,76.0,94.3],'cp',[],'f',[]];ig.ImpactSplashLoader.PATHS_IMPACT=['bp',[],'m',[128.8,98.7],'l',[114.3,98.7],'l',[114.3,26.3],'l',[128.8,26.3],'l',[128.8,98.7],'cp',[],'f',[],'bp',[],'m',[159.2,70.1],'l',[163.6,26.3],'l',[184.6,26.3],'l',[184.6,98.7],'l',[170.3,98.7],'l',[170.3,51.2],'l',[164.8,98.7],'l',[151.2,98.7],'l',[145.7,50.7],'l',[145.7,98.7],'l',[134.1,98.7],'l',[134.1,26.3],'l',[155.0,26.3],'l',[159.2,70.1],'cp',[],'f',[],'bp',[],'m',[204.3,98.7],'l',[189.8,98.7],'l',[189.8,26.3],'l',[211.0,26.3],'bc',[220.0,26.3,224.5,30.7,224.5,39.7],'l',[224.5,60.1],'bc',[224.5,69.1,220.0,73.6,211.0,73.6],'l',[204.3,73.6],'l',[204.3,98.7],'cp',[],'m',[207.4,38.7],'l',[204.3,38.7],'l',[204.3,61.2],'l',[207.4,61.2],'bc',[209.1,61.2,210.0,60.3,210.0,58.6],'l',[210.0,41.3],'bc',[210.0,39.5,209.1,38.7,207.4,38.7],'cp',[],'f',[],'bp',[],'m',[262.7,98.7],'l',[248.3,98.7],'l',[247.1,88.2],'l',[238.0,88.2],'l',[237.0,98.7],'l',[223.8,98.7],'l',[233.4,26.3],'l',[253.1,26.3],'l',[262.7,98.7],'cp',[],'m',[239.4,75.5],'l',[245.9,75.5],'l',[242.6,43.9],'l',[239.4,75.5],'cp',[],'f',[],'bp',[],'m',[300.9,66.7],'l',[300.9,85.9],'bc',[300.9,94.9,296.4,99.4,287.4,99.4],'l',[278.5,99.4],'bc',[269.5,99.4,265.1,94.9,265.1,85.9],'l',[265.1,39.1],'bc',[265.1,30.1,269.5,25.6,278.5,25.6],'l',[287.2,25.6],'bc',[296.2,25.6,300.7,30.1,300.7,39.1],'l',[300.7,56.1],'l',[286.4,56.1],'l',[286.4,40.7],'bc',[286.4,38.9,285.6,38.1,283.8,38.1],'l',[282.1,38.1],'bc',[280.4,38.1,279.5,38.9,279.5,40.7],'l',[279.5,84.3],'bc',[279.5,86.1,280.4,86.9,282.1,86.9],'l',[284.0,86.9],'bc',[285.8,86.9,286.6,86.1,286.6,84.3],'l',[286.6,66.7],'l',[300.9,66.7],'cp',[],'f',[],'bp',[],'m',[312.5,98.7],'l',[312.5,39.2],'l',[303.7,39.2],'l',[303.7,26.3],'l',[335.8,26.3],'l',[335.8,39.2],'l',[327.0,39.2],'l',[327.0,98.7],'l',[312.5,98.7],'cp',[],'f',[]];});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.frame=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f-0.0001);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=x;this.pos.y=this.last.y=y;ig.merge(this,settings);},reset:function(x,y,settings){var proto=this.constructor.prototype;this.pos.x=x;this.pos.y=y;this.last.x=x;this.last.y=y;this.vel.x=proto.vel.x;this.vel.y=proto.vel.y;this.accel.x=proto.accel.x;this.accel.y=proto.accel.y;this.health=proto.health;this._killed=proto._killed;this.standing=proto.standing;this.type=proto.type;this.checkAgainst=proto.checkAgainst;this.collides=proto.collides;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(totalWidth,totalHeight),this.chunkSize);var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;chunk.retinaResolutionEnabled=false;var chunkContext=chunk.getContext('2d');ig.System.scaleMode(chunk,chunkContext);var screenContext=ig.system.context;ig.system.context=chunkContext;for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=screenContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX+=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY+=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this._deferredKill[i].erase();this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/plugins/ss/texture-canvas.js
ig.baked=true;ig.module('plugins.ss.texture-canvas').defines(function()
{if(typeof(ss)==="undefined")ss={};ss.texture2DCanvas=undefined;ss.texture2DContext=undefined;ss.mainCanvasIs2D=false;ig.System.inject({init:function()
{this.parent.apply(this,arguments);ss.texture2DCanvas=this.canvas.cloneNode(false);ss.texture2DCanvas.id="dialog-manager";ss.texture2DCanvas.width=this.canvas.width;ss.texture2DCanvas.height=this.canvas.height;ss.texture2DCanvas.style.display="none";ss.texture2DCanvas.style.background="transparent";ss.texture2DCanvas.style.backgroundColor="transparent";document.body.appendChild(ss.texture2DCanvas);ss.texture2DContext=ss.texture2DCanvas.getContext("2d");ss.mainCanvasIs2D=this.context instanceof CanvasRenderingContext2D;}});});

// lib/plugins/ss/true-font.js
ig.baked=true;ig.module('plugins.ss.true-font').requires('plugins.ss.texture-canvas').defines(function()
{if(typeof(ss)==="undefined")ss={};ss.TrueFont=ig.Class.extend({fontName:"",color:"black",direction:"ltr",textSize:10,lineSpacing:1,alpha:0,loaded:false,failed:false,loadCallback:null,cache:{},currentImage:(new Image()),init:function(fontName,size,color,fontCSS)
{this.fontName=fontName;this.textSize=size;this.color=color;if(typeof(fontName)!=="string"){this.fontName="sans-serif";console.warn("Font initialized without specifying font name");}
if(typeof(size)!=="number"){this.textSize=10;console.warn("Font initialized without specifying size");}
if(typeof(color)!=="string"){this.color="black";console.warn("Font initialized without specifying color");}
if(typeof(fontCSS)!=="string"){this.loaded=true;}
this.load();if(typeof(fontCSS)==="string"){var trueFont=this;if(typeof(WebFont)==="undefined"){console.warn("I highly reccomend using the Web Font Loader [ https://github.com/typekit/webfontloader ] with this plugin for consistent results.");setTimeout(function(){trueFont.prepareImage("#test#",0,0,undefined,undefined,true);setTimeout(function(){trueFont.prepareImage("#test#",0,0,undefined,undefined,true);trueFont.loaded=true;trueFont.onload();},1000);},400);}else{var webDir=location.pathname.substr(0,location.pathname.lastIndexOf("/"),-1)+'/';WebFont.load({custom:{families:[this.fontName],urls:[webDir+fontCSS]},active:function(){trueFont.onload();},timeout:2000});}}},load:function(loadCallback){if(this.loaded){this.loadCallback=loadCallback
return this.onload();}
else if(!this.loaded&&ig.ready)this.loadCallback=loadCallback;else ig.addResource(this);},onload:function(){this.loaded=true;this.cache={};if(typeof(this.loadCallback)==="function")this.loadCallback(undefined,true);},widthForString:function(text)
{ss.texture2DContext.font=this.textSize+"px/1em "+this.fontName;var textLines=text.split('\n');var biggestWidth=0;for(var i=0;i<textLines.length;i++){var width=ss.texture2DContext.measureText(textLines[i]).width;if(width>biggestWidth)biggestWidth=width;}
return width;},heightForString:function(text)
{return text.split('\n').length*(this.textSize+this.lineSpacing);},prepareImage:function(text,x,y,align,alpha,textBaseline,overrideCache)
{if(!ss.texture2DContext)return;if(typeof this.cache[alpha]==="undefined"){this.cache[alpha]={};}
if(typeof this.cache[alpha][text]!=="undefined"&&overrideCache!==true){this.currentImage=this.cache[alpha][text];return;}
ss.texture2DContext.clearRect(0,0,ss.texture2DCanvas.width,ss.texture2DCanvas.height);ss.texture2DContext.fillStyle=this.color;ss.texture2DContext.direction=this.direction;ss.texture2DContext.textAlign=typeof(align)==="undefined"?"start":ss.TrueFont.convertAlignment(align);ss.texture2DContext.textBaseline=typeof(textBaseline)==="string"?textBaseline:"top";ss.texture2DContext.font=(ig.system.scale*this.textSize)+"px/1em "+this.fontName;if(alpha!==1){ig.system.context.globalAlpha=alpha;}
ss.texture2DContext.fillText(text,ig.system.scale*x,ig.system.scale*(y+this.lineSpacing));if(alpha!==1){ig.system.context.globalAlpha=1;}
this.currentImage=new Image();this.currentImage.src=ss.texture2DCanvas.toDataURL('image/png');this.cache[alpha][text]=this.currentImage;},draw:function(text,x,y,align,alpha,textBaseline,overrideCache){if(typeof(align)==="number"){switch(align){case 0:align=ss.TrueFont.ALIGN.START;break;case 1:align=ss.TrueFont.ALIGN.END;break;case 2:align=ss.TrueFont.ALIGN.CENTER;break;}}
if(typeof(alpha)!=="number"||alpha<0||alpha>1){alpha=this.alpha;}
this.prepareImage(text,x,y,align,alpha,textBaseline,overrideCache);if(ss.mainCanvasIs2D){ig.system.context.drawImage(this.currentImage,0,0);}else{}}});ss.TrueFont.ALIGN={LEFT:0,RIGHT:1,CENTER:2,};ss.TrueFont.ActualAlignments={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"};ss.TrueFont.convertAlignment=function(value){if(typeof(value)==="string"){switch(value){case ss.TrueFont.ActualAlignments.LEFT:case ss.TrueFont.ActualAlignments.START:return ss.TrueFont.ALIGN.LEFT;case ss.TrueFont.ActualAlignments.CENTER:return ss.TrueFont.ALIGN.CENTER;case ss.TrueFont.ActualAlignments.RIGHT:case ss.TrueFont.ActualAlignments.END:return ss.TrueFont.ALIGN.RIGHT;}}else if(typeof(value)==="number"){switch(value){case ss.TrueFont.ALIGN.LEFT:return ss.TrueFont.ActualAlignments.LEFT;case ss.TrueFont.ALIGN.CENTER:return ss.TrueFont.ActualAlignments.CENTER;case ss.TrueFont.ALIGN.RIGHT:return ss.TrueFont.ActualAlignments.RIGHT;}}else{throw"need 0-2 or left-end...";}}});

// lib/plugins/chrome-app.js
ig.baked=true;ig.module('plugins.chrome-app').requires('impact.system').defines(function(){"use strict";ig.System.inject({isChromeApp:(typeof(window.chrome)!=="undefined"&&typeof(chrome.runtime)!=="undefined"&&typeof(chrome.runtime.id)!=="undefined"),isPopup:(window.opener&&!window.statusbar.visible),quit:function(){if(typeof(navigator)!=="undefined"&&typeof(navigator.app)!=="undefined"&&typeof(navigator.app.exitApp)==="function"){navigator.app.exitApp();}else if(ig.system.isChromeApp||ig.system.isPopup){window.close();}}});});

// lib/plugins/localstorage.js
ig.baked=true;ig.module('plugins.localstorage').defines(function()
{ig.localStorage=ig.Class.extend({enabled:false,isChromeStorage:false,init:function()
{if(typeof(chrome)==="object"&&typeof(chrome.storage)==="object"&&typeof(chrome.storage.local)==="object")
{this.enabled=true;this.isChromeStorage=true;}
else if(typeof(window.localStorage)==='object'){this.enabled=true;try{localStorage.setItem('localStorage',1);localStorage.removeItem('localStorage');this.isChromeStorage=false;}catch(e){this.enabled=false;alert('Your web browser does not support storing settings locally.');}}else{this.enabled=false;}},get:function(key,onFinish)
{if(typeof(key)!=="string")throw"key must be a string!";if(typeof(onFinish)!=="function"){throw"Using a localstorage 'get' without callback!";}
if(this.isChromeStorage){chrome.storage.local.get(key,function(result){if(key in result&&result[key]!=={}){try{onFinish(result[key]+"");}catch(e){}}
else{try{onFinish(null);}catch(e){}}});}
else{try{onFinish(localStorage.getItem(key));}catch(e){}}},set:function(key,value)
{if(typeof(key)!=="string")throw"key must be a string!";if(this.isChromeStorage)
{var data={};data[key]=value;return chrome.storage.local.set(data);}
else
{return localStorage.setItem(key,value);}},remove:function(key)
{if(typeof(key)!=="string")throw"key must be a string!";if(this.isChromeStorage)
{return chrome.storage.local.remove(key);}
else
{return localStorage.removeItem(key);}}});});

// lib/game/colors.js
ig.baked=true;ig.module('game.colors').defines(function(){NormalGameColors={DialogBGOutline:"#f49242",DialogBG:"#f7efd7",DialogFG:"#444"};AltGameColors={DialogBGOutline:"#000",DialogBG:"#1F1F1F",DialogFG:"#cfcfcf"};GameColors=NormalGameColors;hexToRgbA=function(hex,opacity){var c;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){c=hex.substring(1).split('');if(c.length==3){c=[c[0],c[0],c[1],c[1],c[2],c[2]];}
c='0x'+c.join('');return'rgba('+[(c>>16)&255,(c>>8)&255,c&255].join(',')+', '+(isNaN(opacity)?1:opacity)+' )';}
throw new Error('Bad Hex');}});

// lib/plugins/ss/logo-splash.js
ig.baked=true;ig.module('plugins.ss.logo-splash').requires('impact.game','impact.image').defines(function()
{if(typeof(ss)==="undefined")ss={};ss.LogoSplash=ig.Class.extend({callback:function(){},timeToShow:5,timeToFadeOut:1,timeToFadeIn:1,displayingTimer:undefined,fadingTimer:undefined,currentLogoIndex:-1,clearScreen:false,isRunning:false,logos:[],init:function(){},run:function(callback){this.callback=typeof(callback)==="function"?callback:function(){};this.isRunning=true;this.displayingTimer=new ig.Timer(0);this.fadingTimer=new ig.Timer(0);this._update();this._draw();},_update:function(){if(!this.isRunning)return;this.update();var logos=this;requestAnimationFrame(function(){logos._update();});},update:function(){if(this.displayingTimer.delta()>=0){this.currentLogoIndex++;if(this.currentLogoIndex>=this.logos.length){this.callback();this.isRunning=false;return;}
this.displayingTimer=new ig.Timer(this.timeToShow);this.clearScreen=true;}},_draw:function(){if(!this.isRunning)return;this.draw();var logos=this;requestAnimationFrame(function(){logos._draw();});},draw:function(){if(this.logos[this.currentLogoIndex]instanceof ig.Image)
this.logos[this.currentLogoIndex].draw((ig.system.width-this.logos[this.currentLogoIndex].width)/2,(ig.system.height-this.logos[this.currentLogoIndex].height)/2,);var drawBlack=false;if(this.timeToShow-this.timeToFadeIn<-this.displayingTimer.delta()){alpha=(-this.displayingTimer.delta()-(this.timeToShow-this.timeToFadeIn))/this.timeToFadeIn;}else if(this.timeToFadeOut>-this.displayingTimer.delta()){alpha=(this.timeToFadeOut+this.displayingTimer.delta())/this.timeToFadeOut;}
if(!!alpha){ig.system.context.fillStyle='rgba(0,0,0,'+alpha+')';ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);}}});});

// lib/game/logos.js
ig.baked=true;ig.module('game.logos').requires('plugins.ss.logo-splash').defines(function()
{Logos=ss.LogoSplash.extend({timeToShow:3,logos:[]});});

// lib/game/i18n.js
ig.baked=true;ig.module('game.i18n').requires('plugins.localstorage').defines(function()
{Lang=ig.Class.extend({name:"",code:"",init:function(reviewed,name,code,strings)
{if(typeof(reviewed)!=="boolean")throw"Reviewed must be a boolean!";if(typeof(name)!=="string")throw"Language must have a name";if(typeof(code)!=="string")throw"Language must have an i18n code";this.reviewed=reviewed;this.name=name;this.code=code;for(var i in strings){this[i]=strings[i];}}});ig.langs=new(ig.Class.extend({enUS:new Lang(true,"US English","enUS",{"GameTitle":"Switchboard Copper","Credits":["Software Development:","    Samuel J Sarette","Writing:","    Justin Thibault, Samuel J Sarette","Art:","    KD Doyle","Music:","    Hall of the Mountain King - Kevin MacLeod","    Airship Fury - Jahzzar"],"menuback":"back","PauseMenu":{"Main":{"Continue":"Continue","Toggle Fullscreen":"Toggle Fullscreen (F)","Main Menu":"Main Menu","Save":"Save","Quit":"Quit",},"MainMenuSure":"Quit to Menu? You will lose unsaved progress.","QuitSure":"Really Quit?"},"MainMenu":{"Push":{"Press Start":"Press Start"},"Main":{"Play":"Play","Load":"Load","Options":"Options","Achievements":"Achievements","Quit":"Quit"},"Options":{"Fullscreen":"Toggle Fullscreen (F)","Controls":"Controls","Language":"Language","Music Enabled":"Music: Enabled","Music Disabled":"Music: Disabled"},"Controls":{},"QuitSure":"Really Quit?"},"Answer":{"yes":"yes","sure":"sure","no":"no",}})}));ig.lang=new(ig.Class.extend({current:null,localStorage:new ig.localStorage(),init:function()
{var lang=this;this.localStorage.get("lang",function(language){if(language===null){var languageCode=navigator.language.replace(/-/,"");var autoLang=ig.langs[languageCode];if(!!autoLang){console.debug("Detected language: "+languageCode);lang.set(autoLang,true);}else{var langFound=false;var countryCode=navigator.language.substring(0,navigator.language.indexOf('-'));var codes=this.getCodes();for(var i=0;i<codes.length;i++){if(codes[i].indexOf(countryCode)==0){console.debug("Detected language: "+codes[i]);lang.set(ig.langs[codes[i]],false);langFound=true;break;}}
if(!langFound){console.debug("Language defaulting to: enUS");lang.set(ig.langs.enUS,true);}}}else{console.debug("Setting loaded: lang = "+language);lang.set(ig.langs[language],false);}});},set:function(lang,save)
{if(typeof(lang)==="string")
{if(lang in ig.langs===false)throw"No such language!";lang=ig.langs[lang];}
if(save!==false)this.localStorage.set("lang",lang.code);this.current=lang;if(lang.reviewed===false)console.warn("This language has not been reviewed! Expect bad a transalation!");},getCodes:function(reviewedOnly)
{var langArray=Object.keys(ig.langs);if(reviewedOnly===false)
{return langArray;}
return langArray.filter(function(value)
{return ig.langs[value].reviewed;});},format:function(text)
{if(typeof(sprintf)!=="function")throw"sprintf not available!";return sprintf.apply(undefined,arguments);}}));ig.i18n=function()
{return ig.lang.current;};});

// lib/plugins/touch-button.js
ig.baked=true;ig.module('plugins.touch-button').requires('impact.system','impact.input','impact.image').defines(function(){"use strict";ig.TouchButton=ig.Class.extend({action:'undefined',image:null,tile:0,pos:{x:0,y:0},size:{x:0,y:0},area:{x1:0,y1:0,x2:0,y2:0},pressed:false,touchId:0,anchor:null,init:function(action,anchor,width,height,image,tile){this.action=action;this.anchor=anchor;this.size={x:width,y:height};this.image=image||null;this.tile=tile||0;},align:function(w,h){if('left'in this.anchor){this.pos.x=this.anchor.left;}
else if('right'in this.anchor){this.pos.x=w-this.anchor.right-this.size.x;}
if('top'in this.anchor){this.pos.y=this.anchor.top;}
else if('bottom'in this.anchor){this.pos.y=h-this.anchor.bottom-this.size.y;}
var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var s=ig.system.scale*(internalWidth/ig.system.realWidth);this.area={x1:this.pos.x*s,y1:this.pos.y*s,x2:(this.pos.x+this.size.x)*s,y2:(this.pos.y+this.size.y)*s};this.anchor.left=Math.floor(this.anchor.left);this.anchor.right=Math.floor(this.anchor.right);this.anchor.top=Math.floor(this.anchor.top);this.anchor.bottom=Math.floor(this.anchor.bottom);this.pos.x=Math.floor(this.pos.x);this.area.x1=Math.floor(this.area.x1);this.area.x2=Math.ceil(this.area.x2);this.pos.y=Math.floor(this.pos.y);this.area.y1=Math.floor(this.area.y1);this.area.y2=Math.ceil(this.area.y2);},touchStart:function(ev){if(this.pressed){return;}
var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
for(var i=0;i<ev.touches.length;i++){var touch=ev.touches[i];if(this.checkStart(touch.identifier,touch.clientX-pos.left,touch.clientY-pos.top)){return;}}},touchEnd:function(ev){if(!this.pressed){return;}
for(var i=0;i<ev.changedTouches.length;i++){if(this.checkEnd(ev.changedTouches[i].identifier)){return;}}},touchStartMS:function(ev){if(this.pressed){return;}
var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
this.checkStart(ev.pointerId,ev.clientX-pos.left,ev.clientY-pos.top);},touchEndMS:function(ev){if(!this.pressed){return;}
this.checkEnd(ev.pointerId);},checkStart:function(id,x,y){if(x>this.area.x1&&x<this.area.x2&&y>this.area.y1&&y<this.area.y2){this.pressed=true;this.touchId=id;ig.input.actions[this.action]=true;if(!ig.input.locks[this.action]){ig.input.presses[this.action]=true;ig.input.locks[this.action]=true;}
return true;}
return false;},checkEnd:function(id){if(id===this.touchId){this.pressed=false;this.touchId=0;ig.input.delayedKeyup[this.action]=true;return true;}
return false;},draw:function(){if(this.image){this.image.drawTile(this.pos.x,this.pos.y,this.tile,this.size.x,this.size.y);}}});ig.TouchButtonCollection=ig.Class.extend({buttons:[],touchStartBound:null,touchEndBound:null,touchStartMSBound:null,touchEndMSBound:null,init:function(buttons){this.buttons=buttons;this.touchStartBound=this.touchStart.bind(this);this.touchEndBound=this.touchEnd.bind(this);this.touchStartMSBound=this.touchStartMS.bind(this);this.touchEndMSBound=this.touchEndMS.bind(this);ig.system.canvas.addEventListener('touchstart',this.touchStartBound,false);ig.system.canvas.addEventListener('touchend',this.touchEndBound,false);ig.system.canvas.addEventListener('MSPointerDown',this.touchStartMSBound,false);ig.system.canvas.addEventListener('MSPointerUp',this.touchStartMSBound,false);document.body.style.msTouchAction='none';},remove:function(){ig.system.canvas.removeEventListener('touchstart',this.touchStartBound,false);ig.system.canvas.removeEventListener('touchend',this.touchEndBound,false);ig.system.canvas.removeEventListener('MSPointerDown',this.touchStartMSBound,false);ig.system.canvas.removeEventListener('MSPointerUp',this.touchStartMSBound,false);},touchStart:function(ev){ev.preventDefault();for(var i=0;i<this.buttons.length;i++){this.buttons[i].touchStart(ev);}},touchEnd:function(ev){ev.preventDefault();for(var i=0;i<this.buttons.length;i++){this.buttons[i].touchEnd(ev);}},touchStartMS:function(ev){ev.preventDefault();for(var i=0;i<this.buttons.length;i++){this.buttons[i].touchStartMS(ev);}},touchEndMS:function(ev){ev.preventDefault();for(var i=0;i<this.buttons.length;i++){this.buttons[i].touchEndMS(ev);}},align:function(){var w=ig.system.width||window.innerWidth;var h=ig.system.height||window.innerHeight;for(var i=0;i<this.buttons.length;i++){this.buttons[i].align(w,h);}},draw:function(){for(var i=0;i<this.buttons.length;i++){this.buttons[i].draw();}}});});

// lib/plugins/ss/menu/option.js
ig.baked=true;ig.module('plugins.ss.menu.option').requires('impact.font','plugins.touch-button').defines(function(){if(typeof(ss)==="undefined")ss={};ss.MenuOption=ig.Class.extend({x:0,y:0,selectTarget:{x:0,y:0,width:0,height:0},width:0,height:0,textFunction:function(){return"";},text:"",action:function(){return console.error("This MenuOption somehow doesn't have an action associated with it.");},touchButton:null,alpha:1,selected:false,selectable:true,disabled:false,visible:true,alignment:ig.Font.ALIGN.CENTER,menu:null,init:function(menu,textGetter,action,x,y,alignment,padding,visible)
{if(typeof(menu)!=="object")throw"Must provide menu object";if(menu.useText===false){}else if(menu.useTrueFont){if(typeof(menu.trueFont)==="undefined"||menu.trueFont instanceof ss.TrueFont===false)throw"menu.trueFont must be a ss.TrueFont";}else{if(typeof(menu.font)==="undefined"||menu.font instanceof ig.Font===false)throw"menu.font must be a ig.Font";}
if(typeof(textGetter)!=="function")throw"textGetter must be a function";if(typeof(action)!=="function")
{action=function(){return console.error("This MenuOption is not selectable! Something is coded wrong.");};this.selectable=false;}
if(this.selectable===false){this.alpha=0.8;}
if(isNaN(x))throw"x must be a number";if(isNaN(y))throw"y must be a number";if(alignment in Object.keys(ig.Font.ALIGN)===false)throw"alignment must be a value of ig.Font.ALIGN";if(typeof(padding)==="undefined")padding=6;else if(isNaN(padding))throw"padding must be a number if provided";this.menu=menu;this.textGetter=textGetter;this.action=action;this.x=Math.floor(x);this.y=Math.floor(y);this.alignment=alignment;this.padding=padding;this.visible=typeof(visible)==="boolean"?visible:true;this.updateText();},updateText:function()
{if(this.menu.useText===false)return;this.text=this.textGetter();if(typeof(this.text)!=="string"){console.error("Option text update failed to produce valid text.");return;}
var newlines=(this.text.match(/\n/g)||[]).length;if(this.menu.useTrueFont){this.width=Math.ceil(this.menu.trueFont.widthForString(this.text));this.height=Math.ceil(this.menu.trueFont.heightForString(this.text))+this.padding;}else{this.width=Math.ceil(this.menu.font.widthForString(this.text));this.height=(this.menu.font.height*(1+newlines))+this.padding;}
if(this.alignment===ig.Font.ALIGN.LEFT){this.selectTarget.x=this.x-this.padding;}else if(this.alignment===ig.Font.ALIGN.CENTER){this.selectTarget.x=this.x-Math.floor(this.width/2)-this.padding;}else if(this.alignment===ig.Font.ALIGN.RIGHT){this.selectTarget.x=this.x-this.width-this.padding;}
this.selectTarget.y=this.y-this.padding;if(this.selectTarget.x<0)this.selectTarget.x=0;this.selectTarget.width=this.width+this.padding+(this.menu.useSideCursorImage?this.menu.sideCursorImage.width:0);if(this.selectTarget.width>ig.system.width)this.selectTarget.width=ig.system.width+(this.menu.useSideCursorImage?this.menu.sideCursorImage.width:0);if(this.selectTarget.y<0)this.selectTarget.y=0;this.selectTarget.height=this.height+this.padding;if(this.selectTarget.height>ig.system.height)this.selectTarget.height=ig.system.height;this.createTouchButton();if(this.menu.useTrueFont){this.menu.trueFont.prepareImage(this.text,this.x,this.y,this.alignment,this.alpha,undefined,false);if(this.menu.useSelectedFont){this.menu.selectedTrueFont.prepareImage(this.text,this.x,this.y,this.alignment,this.alpha,undefined,false);}}
return this.text;},update:function(isSelected){if(this.selectable===false)return;this.selected=isSelected;},createTouchButton:function(){this.touchButton=new ig.TouchButton(this.text,{left:this.selectTarget.x,top:this.selectTarget.y},this.selectTarget.width,this.selectTarget.height);return this.touchButton;},getTouchButton:function(){if(this.touchButton===null){this.createTouchButton();}
return this.touchButton;},draw:function(){if(this.menu.useSideCursorImage){var cursorX=this.selectTarget.x-this.menu.sideCursorImage.width;if(this.selected){this.menu.sideCursorImage.draw(cursorX,this.y);}}
if(this.menu.useText===false)return;if(this.menu.useTrueFont){if(this.menu.useSelectedFont&&this.selected){this.menu.selectedTrueFont.draw(this.text,this.x,this.y,this.alignment,this.alpha,undefined,false);}else{this.menu.trueFont.draw(this.text,this.x,this.y,this.alignment,this.alpha,undefined,false);}}else if(this.menu.useSelectedFont&&this.selected){this.menu.selectedFont.draw(this.text,this.x,this.y,this.alignment,this.alpha);}else{this.menu.font.draw(this.text,this.x,this.y,this.alignment,this.alpha);}}});});

// lib/plugins/ss/menu/cursor.js
ig.baked=true;ig.module('plugins.ss.menu.cursor').requires('plugins.ss.menu.option').defines(function(){if(typeof(ss)==="undefined")ss={};ss.Cursor=ig.Class.extend({isHovering:false,hasMoved:false,lastPosition:{x:-1,y:-1},currentPosition:{x:-1,y:-1},lastMovedTimer:null,init:function()
{this.lastMovedTimer=new ig.Timer(2);this.lastMovedTimer.set(2);this.lastMovedTimer.reset();},update:function(items,menuIndex)
{var position={x:ig.input.mouse.x,y:ig.input.mouse.y};if(position.x!=this.lastPosition.x&&position.y!=this.lastPosition.y)
{this.currentPosition=this.lastPosition;this.lastPosition=position;this.lastMovedTimer.reset();}
this.setHovering(false);if(this.lastMovedTimer.delta()>=0){this.setHovering(false);}
else if(!!items)
{for(var i=0;i<items.length;i++)
{var selectX=typeof(items[i].selectTarget.x)==="function"?items[i].selectTarget.x():items[i].selectTarget.x;var selectY=typeof(items[i].selectTarget.y)==="function"?items[i].selectTarget.y():items[i].selectTarget.y;if(position.x>selectX&&position.x<selectX+items[i].selectTarget.width&&position.y>selectY&&position.y<selectY+items[i].selectTarget.height&&items[i].selectable===true){menuIndex=i;this.setHovering(true);}}}
return{isHovering:this.isHovering,menuIndex:menuIndex};},setHovering:function(isHovering){this.isHovering=isHovering;ig.system.canvas.style.cursor=this.isHovering?"pointer":"";}});});

// lib/plugins/ss/menu/menu.js
ig.baked=true;ig.module('plugins.ss.menu.menu').requires('impact.system','plugins.touch-button','plugins.ss.menu.option','plugins.ss.menu.cursor').defines(function(){if(typeof(ss)==="undefined")ss={};ss.Menu=ig.Class.extend({Page:{},cursor:new ss.Cursor(),useText:true,useTrueFont:false,useSelectedFont:false,font:null,trueFont:null,selectedFont:null,selectedTrueFont:null,useSideCursorImage:false,sideCursorImage:null,actions:{prev:["up","left"],next:["down","right"],select:["primary","paused"],back:["secondary"]},tapToContinueWait:false,dontRefreshGamepad:false,menuIndex:0,currentPage:0,options:[],changePage:function(index)
{this.setupTouchControls();if(index<0)index=0;else if(index>=this.options.length)index=this.options.length-1;this.currentPage=index;this.menuIndex=0;while(this.menuIndex<this.options[this.currentPage].length&&this.options[this.currentPage][this.menuIndex].selectable===false)
{this.menuIndex+=1;}
if(this.menuIndex===this.options[this.currentPage].length)this.menuIndex=0;},pageBack:function()
{this.changePage(this.currentPage-1);},updateAllText:function()
{for(var i=0;i<this.options.length;i++)
{for(var j=0;j<this.options[i].length;j++)
{if(this.options[i][j]instanceof ss.MenuOption)this.options[i][j].updateText();}}},setupTouchControls:function()
{if(typeof(ig.game.disableNormalTouchControls)==="function")ig.game.disableNormalTouchControls();if(this.options.length<=0)return false;var menu=this;ig.game.touchControlsSetup=function(){menu.setupTouchControls();};var touchButtons=[];for(var i=0;i<this.options[this.currentPage].length;i++){var touchButton=this.options[this.currentPage][i].getTouchButton();if(touchButton instanceof ig.TouchButton)touchButtons.push(touchButton);}
ig.game.touchButtons=new ig.TouchButtonCollection(touchButtons);ig.game.touchButtons.align();return true;},init:function(){var menu=this;if(typeof(ig.input.onGamepadChange)==="function")
ig.input.onGamepadChange(function(){if(menu.dontRefreshGamepad!==true){menu.createMenuOptions();}});},update:function(){if(this.options instanceof Array===false||this.options.length===0)return;for(var i=0;i<this.actions.prev.length;i++){if(ig.input.released(this.actions.prev[i])){var proposedIndex=this.menuIndex;proposedIndex-=1;while(proposedIndex>=0&&this.options[this.currentPage][proposedIndex].selectable===false)proposedIndex-=1;if(proposedIndex>=0)this.menuIndex=proposedIndex;}}
for(var i=0;i<this.actions.next.length;i++){if(ig.input.released(this.actions.next[i])){var proposedIndex=this.menuIndex;var totalItems=this.options[this.currentPage].length;proposedIndex+=1;while(proposedIndex<totalItems&&this.options[this.currentPage][proposedIndex].selectable===false)proposedIndex+=1;if(proposedIndex<totalItems)this.menuIndex=proposedIndex;}}
for(var i=0;i<this.actions.back.length;i++){if(ig.input.released(this.actions.back[i])){this.pageBack();}}
var mouseInfo=this.cursor.update(this.options[this.currentPage],this.menuIndex);if(mouseInfo.isHovering)
{this.menuIndex=mouseInfo.menuIndex;}
if(this.options.length>0)for(var i=0;i<this.options[this.currentPage].length;i++){this.options[this.currentPage][i].update(this.menuIndex===i);}
if(typeof(this.options[this.currentPage])!=="undefined")
{for(var i=0;i<this.actions.select.length;i++){if(ig.input.released(this.actions.select[i])){this.options[this.currentPage][this.menuIndex].action();this.cursor.setHovering(false);}}}
if(ig.input.released('click')&&mouseInfo.isHovering){this.options[this.currentPage][this.menuIndex].action();this.cursor.setHovering(false);}},draw:function(){if(this.options.length>0)for(var i=0;i<this.options[this.currentPage].length;i++)
{this.options[this.currentPage][i].draw();}}});});

// lib/game/menu/title.js
ig.baked=true;ig.module('game.menu.title').requires('game.i18n','plugins.ss.menu.menu','plugins.ss.true-font').defines(function(){TitleMenu=ss.Menu.extend({startBlinkTimer:null,useTrueFont:true,trueFont:new ss.TrueFont("Cavalcade",36,"#ccc","/fonts/Cavalcade/Cavalcade-Regular.css"),useSelectedFont:true,selectedTrueFont:new ss.TrueFont("Cavalcade",36,"#fff","/fonts/Cavalcade/Cavalcade-Regular.css"),background:new ig.Image("media/background/desk.jpg"),Page:{MAIN:0,SETTINGS:1,CONTROLS:2,LANGUAGE:3,LOAD:4,QUITSURE:5},actions:{prev:["up","left"],next:["down","right"],select:["primary"],back:["secondary"]},init:function()
{this.startBlinkTimer=new ig.Timer();this.createMenuOptions();this.parent();},titleFont:new ss.TrueFont("Cavalcade",64,"#111","/fonts/Cavalcade/Cavalcade-Regular.css"),titleText:function(){return ig.i18n().GameTitle;},pageBack:function()
{switch(this.currentPage){case this.Page.CONTROLS:case this.Page.LANGUAGE:this.changePage(this.Page.SETTINGS);break;case this.Page.SETTINGS:case this.Page.LOAD:case this.Page.QUITSURE:this.changePage(this.Page.MAIN);break;default:break;}},createMenuOptions:function()
{var menu=this;var options=[];for(var i=0;i<Object.keys(menu.Page).length;i++)options.push([]);options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return ig.i18n().MainMenu.Main.Play;},function(){ig.game.startNewGame();},160,(ig.system.height-320),ig.Font.ALIGN.CENTER,undefined));var currentCreditsY=280;for(var i=0;i<ig.i18n().Credits.length;i++){let credit=ig.i18n().Credits[i];var credits=new ss.MenuOption(menu,function(){return credit;},function(){},ig.system.width-680,currentCreditsY,ig.Font.ALIGN.LEFT,undefined);credits.selectable=false;options[menu.Page.MAIN].push(credits);currentCreditsY+=this.trueFont.textSize+4;}
this.options=options;},update:function()
{if(this.stopListeningToInput)return;if(this.currentPage===this.Page.LOBBY)
{var gamepadsCount=gi.gamepadsCount();if(gamepadsCount!==this.lastCountedGamepads){this.lastCountedGamepads=gi.gamepadsCount();this.playersStatusOption.updateText();}
if(ig.input.state("p1-pause")){if(this.holdATimer.target===0){this.holdATimer.set(1);this.holdToStartOption.updateText();}else if(this.holdATimer.delta()>=0){this.stopListeningToInput=true;ig.game.startNewGame();}}
else{this.holdATimer.set(0);this.holdToStartOption.updateText();}}
this.parent();},draw:function()
{this.background.draw(0,0);ig.system.context.fillStyle='#af874c';ig.system.context.fillRect((ig.system.width/2)-290,110,580,120);ig.system.context.fillStyle='#826539';ig.system.context.fillRect((ig.system.width/2)-280,120,560,100);this.titleFont.draw(this.titleText(),ig.system.width/2,140,ss.TrueFont.ALIGN.CENTER,1);if(this.currentPage===this.Page.LOBBY)
{for(var i=1;i<=this.lastCountedGamepads;i++){this.joinImage[i].draw((ig.system.width*((i-1)/ig.input.maxPlayers))
+((ig.system.width/ig.input.maxPlayers)-this.joinImage[i].width)/2,ig.system.height-this.joinImage[i].height-20);var icon=ig.input.getGameInputIcon(i);icon.draw((ig.system.width*((i-1)/ig.input.maxPlayers))
+((ig.system.width/ig.input.maxPlayers)-icon.width)/2,ig.system.height-icon.height-10);}
if(this.lastCountedGamepads===0)
{this.joinImage[i].draw(((ig.system.width/ig.input.maxPlayers)-this.joinImage[i].width)/2,ig.system.height-this.joinImage[i].height-20);icon=ig.input.icons.keyboard;icon.draw(((ig.system.width/ig.input.maxPlayers)-icon.width)/2,ig.system.height-icon.height-10);}}
this.parent();}});});

// lib/plugins/ss/random.js
ig.baked=true;ig.module('plugins.ss.random').defines(function()
{if(typeof(ss)==="undefined")ss={};ss.Random=new(ig.Class.extend({int:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},item:function(){var array=[];if(arguments[0]instanceof Array){array=arguments[0];}else{array=arguments;}
var index=this.int(0,array.length-1);return array[index];}}));});

// lib/plugins/ss/dialog.js
ig.baked=true;ig.module('plugins.ss.dialog').requires('impact.system','impact.game','impact.timer','impact.entity','plugins.ss.texture-canvas','plugins.ss.menu.cursor','plugins.ss.true-font').defines(function(){"use strict";if(typeof(ss)==="undefined")ss={};ss.GlobalDialogManager={dialogIsActive:false,textSize:10,minHeight:20,textLinePadding:2,textEdgePadding:2,outlineThickness:4,bottomMargin:20,leftMargin:100,rightMargin:100,choiceCursorPadding:10,fontName:"sans-serif bold",fontColor:"rgba(0,0,0,1)",bgColor:"rgba(190, 190, 190, 1)",outlineColor:"rgb(30, 30, 30)",upButtons:['up'],downButtons:['down'],leftButtons:['left'],rightButtons:['right'],selectButtons:['primary'],cancelButtons:['cancel'],cursor:new ss.Cursor(),inputNavDelayTimer:new ig.Timer(),betweenActionsTimer:new ig.Timer(),trueFont:undefined,loadFont:function(name,css){this.trueFont=new ss.TrueFont(name,this.textSize,this.fontColor,css);}};var scaled=function(value){return value*ig.system.scale;}
var descaled=function(value){return value/ig.system.scale;}
var eachPlayer=function(action){if(typeof(ig.game.player)==="object"){action(ig.game.player);}else if(typeof(ig.game.players)==="object"&&ig.game.players.length>0){for(var i=0;i<ig.game.players.length;i++){action(ig.game.players[i]);}}else{}}
var anyUpPressed=function(){for(var i=0;i<ss.GlobalDialogManager.upButtons.length;i++){if(ig.input.pressed(ss.GlobalDialogManager.upButtons[i])){return true;}}
return false}
var anyDownPressed=function(){for(var i=0;i<ss.GlobalDialogManager.downButtons.length;i++){if(ig.input.pressed(ss.GlobalDialogManager.downButtons[i])){return true;}}
return false}
var anyLeftPressed=function(){for(var i=0;i<ss.GlobalDialogManager.leftButtons.length;i++){if(ig.input.pressed(ss.GlobalDialogManager.leftButtons[i])){return true;}}
return false}
var anyRightPressed=function(){for(var i=0;i<ss.GlobalDialogManager.rightButtons.length;i++){if(ig.input.pressed(ss.GlobalDialogManager.rightButtons[i])){return true;}}
return false}
var anySelectReleased=function(){for(var i=0;i<ss.GlobalDialogManager.selectButtons.length;i++){if(ig.input.released(ss.GlobalDialogManager.selectButtons[i])){return true;}}
return false}
var anyCancelReleased=function(){for(var i=0;i<ss.GlobalDialogManager.cancelButtons.length;i++){if(ig.input.released(ss.GlobalDialogManager.cancelButtons[i])){return true;}}
return false}
ss.DialogManagedEntity=ig.Entity.extend({dialogManager:undefined,update:function(){this.parent();if(typeof(this.dialogManager)!=="undefined"){this.dialogManager.update();}},});ss.DialogCharacter=ig.Class.extend({x:0,y:0,animation:undefined,init:function(x,y,animation){this.x=x||0;this.y=y||0;this.animation=animation;if(animation instanceof ig.Animation==false){throw"Must provide an animation!";}}});ss.DialogMoment=ig.Class.extend({text:undefined,character:undefined,init:function(text,character){if(typeof(text)==="function"){this._getText=text;this.refreshText();}
else{this.text=text;}
if(typeof(character)==="object"){this.setCharacter(character);}},refreshText:function()
{if(typeof(this._getText)==="function")
{this.text=this._getText();}},trigger:function(manager,action)
{if(ss.GlobalDialogManager.betweenActionsTimer.delta()<0)return;if(action instanceof ss.DialogAction){action.trigger(manager);}else{manager.endDialog();}
ss.GlobalDialogManager.betweenActionsTimer.set(0.4);},setCharacter:function(character){this.character=character;if(character instanceof ss.DialogCharacter===false){throw"Character must be of type ss.DialogCharacter!";}}});ss.DialogAction=ig.Class.extend({handler:undefined,nextMoment:undefined,init:function(handler,moment)
{this.handler=handler;this.nextMoment=moment;},setHandler:function(handler){this.handler=handler;},setNextMoment:function(moment){this.nextMoment=moment;},trigger:async function(manager){var choice=manager.selectedChoiceIndex;manager.changeActiveMoment(null);if(typeof(this.handler)==="function"){await this.handler(choice);}
if(this.nextMoment instanceof ss.DialogMoment===false){manager.endDialog();}else{manager.changeActiveMoment(this.nextMoment);}}});ss.DialogTextMoment=ss.DialogMoment.extend({action:undefined,nextMoment:undefined,init:function(text,character,action){this.parent(text,character);this.action=action;},setAction:function(action){this.action=action;},trigger:function(manager)
{this.parent(manager,this.action);}});ss.DialogChoiceMoment=ss.DialogMoment.extend({choices:[],_getChoices:{},actions:[],init:function(text,character,choices,actions)
{this.parent(text,character);this.actions=actions;this.setChoices(choices);},setChoices:function(choices)
{this.choices=choices;for(var i=0;i<choices.length;i++){if(typeof(choices[i])==="function"){this._getChoices[i]=choices[i];this.refreshChoice(i);}}},refreshChoice:function(index)
{if(typeof(this._getChoices[index])==="function")
{this.choices[index]=this._getChoices[index]();}},setActions:function(actions){this.actions=actions;},trigger:function(manager)
{this.parent(manager,this.actions[manager.selectedChoiceIndex]);}});ss.DialogTextItem=ig.Class.extend({isChoice:false,selectable:true,x:0,y:0,width:0,height:0,selectTarget:{x:0,y:0,width:0,height:0},init:function(text,isChoice){this.text=text;this.isChoice=isChoice;ss.texture2DContext.font=ss.GlobalDialogManager.textSize+"px "+ss.GlobalDialogManager.fontName;this.unscaledWidth=ss.texture2DContext.measureText(this.text).width+ss.GlobalDialogManager.choiceCursorPadding;ss.texture2DContext.font=scaled(ss.GlobalDialogManager.textSize)+"px "+ss.GlobalDialogManager.fontName;this.width=ss.texture2DContext.measureText(this.text).width+scaled(ss.GlobalDialogManager.choiceCursorPadding);this.height=scaled(ss.GlobalDialogManager.textSize+ss.GlobalDialogManager.textLinePadding)*text.split('\n').length;this.unscaledHeight=(ss.GlobalDialogManager.textSize+ss.GlobalDialogManager.textLinePadding)*text.split('\n').length;this.selectTarget.width=this.unscaledWidth;this.selectTarget.height=this.unscaledHeight;},setPosition:function(x,y){this.unscaledX=x;this.unscaledY=y;this.x=scaled(x);this.y=scaled(y);this.selectTarget.x=this.unscaledX;this.selectTarget.y=this.unscaledY;}});ig.Game.inject({drawDialogManagedContent:function(){var dialogManagedEntities=this.getEntitiesByType(ss.DialogManagedEntity);for(var i=0;i<dialogManagedEntities.length;i++){if(typeof(dialogManagedEntities[i].dialogManager)!=="undefined"){dialogManagedEntities[i].dialogManager.draw();}}}});ss.DialogManager=ig.Class.extend({enabled:false,originalMoment:undefined,activeMoment:undefined,activeGeometry:{height:0,textBacking:(function(){return{x:function(){return scaled(ss.GlobalDialogManager.leftMargin);},y:0,unscaledY:0,getWidth:function(){return ss.texture2DCanvas.width-(this.x()+scaled(ss.GlobalDialogManager.rightMargin));},getHeight:function(){return ss.texture2DCanvas.height-(this.y+scaled(ss.GlobalDialogManager.bottomMargin));},asMouseableItem:function(){var backing=this;return{selectable:true,selectTarget:{x:function(){return descaled(backing.x());},y:function(){return backing.unscaledY;},width:function(){return ss.texture2DCanvas.width-(backing.x()+ss.GlobalDialogManager.rightMargin);},height:function(){return ss.texture2DCanvas.height-(backing.y+ss.GlobalDialogManager.bottomMargin);}}};}};})(),hasChoices:false,items:[]},selectedChoiceIndex:0,blinkTimer:undefined,init:function(firstMoment)
{if(ig.global.wm)return;if(typeof(firstMoment)=="undefined")throw"Need a first moment!";this.blinkTimer=new ig.Timer(1);this.setStartMoment(firstMoment);},setStartMoment:function(moment)
{this.originalMoment=moment;if(typeof(this.activeMoment)==="undefined")this.changeActiveMoment(this.originalMoment);},changeActiveMoment:function(moment)
{this.selectedChoiceIndex=0;this.activeMoment=moment;this._prepActiveGeometry(moment);this._prepImage(moment);},_prepActiveGeometry:function(moment)
{this.activeGeometry.items=[];if(moment instanceof ss.DialogMoment==false)return;moment.refreshText();this.activeGeometry.items.push(new ss.DialogTextItem(moment.text,false));if(moment instanceof ss.DialogChoiceMoment)for(var i=0;i<moment.choices.length;i++){moment.refreshChoice(i);this.activeGeometry.items.push(new ss.DialogTextItem(moment.choices[i],true));}
this.activeGeometry.textBacking.y=ss.texture2DCanvas.height-scaled(ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.bottomMargin);this.activeGeometry.textBacking.unscaledY=descaled(ss.texture2DCanvas.height)-(ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.bottomMargin);for(var i=0;i<this.activeGeometry.items.length;i++){this.activeGeometry.textBacking.y-=scaled(this.activeGeometry.items[i].height+ss.GlobalDialogManager.textLinePadding);this.activeGeometry.textBacking.unscaledY-=this.activeGeometry.items[i].height+ss.GlobalDialogManager.textLinePadding;}
var minY=descaled(ss.texture2DCanvas.height-(ss.GlobalDialogManager.minHeight+ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.bottomMargin));if(this.activeGeometry.textBacking.unscaledY<minY){this.activeGeometry.textBacking.unscaledY=descaled(ss.texture2DCanvas.height)-minY;this.activeGeometry.textBacking.y=ss.texture2DCanvas.height-scaled(minY);}
var currentY=this.activeGeometry.textBacking.unscaledY+ss.GlobalDialogManager.textEdgePadding;for(var i=0;i<this.activeGeometry.items.length;i++){this.activeGeometry.items[i].setPosition(ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.leftMargin,ss.GlobalDialogManager.textLinePadding+currentY);currentY+=this.activeGeometry.items[i].unscaledHeight;}},_choiceCursorImage:(new Image()),_textCursorImage:(new Image()),_prepCursors:function(){ss.texture2DContext.clearRect(0,0,ss.texture2DCanvas.width,ss.texture2DCanvas.height);ss.texture2DContext.font=scaled(ss.GlobalDialogManager.textSize)+"px sans-serif";ss.texture2DContext.fillStyle=ss.GlobalDialogManager.fontColor;ss.texture2DContext.fillText('▼',0,0);this._textCursorImage.src=ss.texture2DCanvas.toDataURL('image/png');ss.texture2DContext.clearRect(0,0,ss.texture2DCanvas.width,ss.texture2DCanvas.height);ss.texture2DContext.fillText('▶',0,0);this._choiceCursorImage.src=ss.texture2DCanvas.toDataURL('image/png');},_preparedImage:(new Image()),_prepImage:function(moment)
{ss.texture2DContext.clearRect(0,0,ss.texture2DCanvas.width,ss.texture2DCanvas.height);var outPX=ss.GlobalDialogManager.outlineThickness;ss.texture2DContext.fillStyle=ss.GlobalDialogManager.outlineColor;ss.texture2DContext.beginPath();ss.texture2DContext.rect(this.activeGeometry.textBacking.x()-outPX,this.activeGeometry.textBacking.y-outPX,this.activeGeometry.textBacking.getWidth()+(outPX*2),this.activeGeometry.textBacking.getHeight()+(outPX*2));ss.texture2DContext.closePath();ss.texture2DContext.fill();ss.texture2DContext.fillStyle=ss.GlobalDialogManager.bgColor;ss.texture2DContext.beginPath();ss.texture2DContext.rect(this.activeGeometry.textBacking.x(),this.activeGeometry.textBacking.y,this.activeGeometry.textBacking.getWidth(),this.activeGeometry.textBacking.getHeight());ss.texture2DContext.closePath();ss.texture2DContext.fill();ss.texture2DContext.fillStyle=ss.GlobalDialogManager.fontColor;ss.texture2DContext.textAlign="start";ss.texture2DContext.textBaseline="top";ss.texture2DContext.direction="ltr";ss.texture2DContext.font=scaled(ss.GlobalDialogManager.textSize)+"px "+ss.GlobalDialogManager.fontName;for(var i=0;i<this.activeGeometry.items.length;i++)
{var lines=this.activeGeometry.items[i].text.split('\n');for(var j=0;j<lines.length;j++){ss.texture2DContext.fillText(lines[j],this.activeGeometry.items[i].x
+scaled(this.activeGeometry.items[i].isChoice?ss.GlobalDialogManager.choiceCursorPadding:0),this.activeGeometry.items[i].y
-scaled(ss.GlobalDialogManager.textLinePadding)
+(j*scaled(ss.GlobalDialogManager.textSize+ss.GlobalDialogManager.textLinePadding)));}}
this._preparedImage.src=ss.texture2DCanvas.toDataURL('image/png');},update:function()
{if(ig.global.wm)return;if(this.triggering===true||ss.GlobalDialogManager.dialogIsActive!==true)return;if(this.activeMoment instanceof ss.DialogChoiceMoment&&this.activeMoment.choices instanceof Array&&this.activeMoment.choices.length>0)
{if(ss.GlobalDialogManager.inputNavDelayTimer.delta()<0){}else if(anyUpPressed()||anyLeftPressed()){var proposedIndex=this.selectedChoiceIndex-1;if(proposedIndex>=0)this.selectedChoiceIndex=proposedIndex;ss.GlobalDialogManager.inputNavDelayTimer.set(0.1);}else if(anyDownPressed()||anyRightPressed()){var proposedIndex=this.selectedChoiceIndex+1;var totalItems=this.activeMoment.choices.length;if(proposedIndex<totalItems)this.selectedChoiceIndex=proposedIndex;ss.GlobalDialogManager.inputNavDelayTimer.set(0.1);}
var mouseInfo=ss.GlobalDialogManager.cursor.update(this.activeGeometry.items.slice(1),this.selectedChoiceIndex);if(mouseInfo.isHovering)
{this.selectedChoiceIndex=mouseInfo.menuIndex;}}
else
{ss.GlobalDialogManager.cursor.update([this.activeGeometry.textBacking.asMouseableItem()],0);}
if((ig.input.released('click')||anySelectReleased())&&this.activeMoment instanceof ss.DialogMoment)
{this.activeMoment.trigger(this);}},draw:function()
{if(ig.global.wm||ss.GlobalDialogManager.dialogIsActive!==true||this.activeMoment instanceof ss.DialogMoment==false)return;if(ss.mainCanvasIs2D){ig.system.context.globalAlpha=1;if(typeof(this.activeMoment.character)==="object"){this.activeMoment.character.animation.draw(this.activeMoment.character.x,this.activeMoment.character.y);}
ig.system.context.drawImage(this._preparedImage,0,0);}else{}
var cursorOpacity=Math.sin(Math.abs(this.blinkTimer.delta()%Math.PI));if(ss.mainCanvasIs2D)
{ig.system.context.globalAlpha=cursorOpacity;if(this.activeMoment instanceof ss.DialogTextMoment){ig.system.context.drawImage(this._textCursorImage,ss.texture2DCanvas.width-scaled(ss.GlobalDialogManager.textSize+ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.rightMargin),ss.texture2DCanvas.height-scaled(ss.GlobalDialogManager.textSize+ss.GlobalDialogManager.bottomMargin));}else{ig.system.context.drawImage(this._choiceCursorImage,scaled(ss.GlobalDialogManager.textEdgePadding+ss.GlobalDialogManager.leftMargin),this.activeGeometry.items[this.selectedChoiceIndex+1].y-scaled(ss.GlobalDialogManager.textSize/2));}
ig.system.context.globalAlpha=1;}
else
{if(this.activeMoment instanceof ss.DialogTextMoment){}else{}}},triggering:false,trigger:function()
{if(ig.global.wm)return;if(this.triggering==true||ss.GlobalDialogManager.dialogIsActive===true||typeof(this.originalMoment)==="undefined")return;this.triggering=true;this._prepCursors();this.changeActiveMoment(this.originalMoment);this.selectedChoiceIndex=0;ss.GlobalDialogManager.dialogIsActive=true;eachPlayer(function(player){if(player.currentAnim==player.anims["walk"+player.currentDirection()]){player.currentAnim=player.anims["idle"+player.currentDirection()].rewind();}});this.triggering=false;},endDialog:function()
{if(ig.global.wm)return;var manager=this;ss.GlobalDialogManager.cursor.setHovering(false);manager.triggering=true;setTimeout(function(){ss.GlobalDialogManager.dialogIsActive=false;manager.changeActiveMoment(manager.originalMoment);manager.triggering=false;},300);}});});

// lib/plugins/ss/ink.js
ig.baked=true;ig.module('plugins.ss.ink').defines(function()
{if(typeof(ss)==="undefined")ss={};ss.Ink=ig.Class.extend({story:undefined,content:undefined,consoleDebug:false,tagHandlers:[],tagLackHandlers:[],init:function(content){this.content=content;this.story=new inkjs.Story(content);},getSaveState:function(){return this.story.state.toJson();},loadState:function(dataString){this.story.state.LoadJson(loadState);},getVar:function(key){var varObj=this.story.variablesState[key];for(var i in varObj._keys){return varObj._keys[i].itemName;}
return null;},continue:function(choiceIndex){if(this.story.currentChoices.length>0){if(typeof(choiceIndex)!=="number"){throw"Must provide a choice index";}else if(choiceIndex<0||choiceIndex>=this.story.currentChoices.length){throw choiceIndex+" is not a valid choice index value. (valid: 0-"
+(this.story.currentChoices.length-1)+")";}
this.story.ChooseChoiceIndex(choiceIndex);}
if(this.story.canContinue===false){throw"Can't continue";}
this.story.Continue();this.processTags(this.getTags());if(this.consoleDebug)console.debug("INK: TEXT:"+this.story.currentText);},isEnded:function(){return this.story.state.didSafeExit||(this.story.currentChoices.length==0&&!this.story.canContinue);},getText:function(){return this.story.currentText.trim();},getChoices:function(){var choices=[];for(var i=0;i<this.story.currentChoices.length;i++){choices.push(this.story.currentChoices[i].text.trim());}
return choices;},getTags:function(){return this.story.currentTags;},processTags:function(tags){if(tags==undefined)return;var usedTags={};for(var i=0;i<tags.length;i++){if(this.consoleDebug)console.debug("INK: TAGS: "+tags[i]);for(var j in this.tagHandlers){if(tags[i].includes(j+":")){this.tagHandlers[j].apply(null,tags[i].split(":"));usedTags[j]=true;}}}
for(var j in this.tagLackHandlers){if(!usedTags[j]){this.tagLackHandlers[j]();}}}});});

// lib/game/menu/daily.js
ig.baked=true;ig.module('game.menu.daily').requires('impact.image','plugins.ss.menu.menu').defines(function(){ss.MenuImageOption=ss.MenuOption.extend({image:undefined,init:function(menu,image,action,x,y,padding,visible){this.parent(menu,function(){return"";},action,x,y,ig.Font.ALIGN.LEFT,padding,visible);if(image instanceof ig.Image===false)throw"image must be an ig.Image!";this.image=image;this.width=this.image.width;this.height=this.image.height;this.selectTarget.x=this.x-this.padding;this.selectTarget.y=this.y-this.padding;this.selectTarget.width=this.width+(this.padding*2);this.selectTarget.height=this.height+(this.padding*2);this.createTouchButton();},updateText:function(){return"";},draw:function(){this.image.draw(this.x,this.y);}});DailyMenu=ss.Menu.extend({useTrueFont:true,trueFont:new ss.TrueFont("Cavalcade",24,"#ccc","/fonts/Cavalcade/Cavalcade-Regular.css"),useSelectedFont:true,selectedTrueFont:new ss.TrueFont("Cavalcade",24,"#eee","/fonts/Cavalcade/Cavalcade-Regular.css"),inkStory:undefined,inkStoryChoices:undefined,Page:{MAIN:0},day:0,actions:{prev:["up","left"],next:["down","right"],select:["primary"],back:["secondary"]},images:{briggs:new ig.Image('media/desk/briggs.png'),custer:new ig.Image('media/desk/custer.png'),doherty:new ig.Image('media/desk/doherty.png'),hughes:new ig.Image('media/desk/hughes.png'),wiley:new ig.Image('media/desk/wiley.png'),note:new ig.Image('media/desk/note.png')},init:function(inkStory,inkStoryChoices,day)
{this.inkStory=inkStory;this.inkStoryChoices=inkStoryChoices;this.startBlinkTimer=new ig.Timer();this.createMenuOptions();ss.GlobalDialogManager.dialogIsActive=false;this.day=day;this.parent();},createMenuOptions:function()
{var menu=this;var options=[[]];var show={wiley:false,briggs:false,doherty:false,hughes:false,custer:false};for(var i=0;i<this.inkStoryChoices.length;i++){for(var j in show){if(this.inkStoryChoices[i].toLowerCase().includes(j)){show[j]=true;}}}
options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.note,function(){menu.inkStory.dailyMenuChosen("note");},544,340));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Refer to Note";},function(){menu.inkStory.dailyMenuChosen("note");},544+128,340+256,ig.Font.ALIGN.CENTER,undefined));if(show.wiley){options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.wiley,function(){menu.inkStory.dailyMenuChosen("wiley");},894,246));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Officer Wiley";},function(){menu.inkStory.dailyMenuChosen("wiley");},894+64,246+128,ig.Font.ALIGN.CENTER,undefined));}
if(show.briggs){options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.briggs,function(){menu.inkStory.dailyMenuChosen("briggs");},1098,246));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Sergeant Briggs";},function(){menu.inkStory.dailyMenuChosen("briggs");},1098+64,246+128,ig.Font.ALIGN.CENTER,undefined));}
if(show.doherty){options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.doherty,function(){menu.inkStory.dailyMenuChosen("doherty");},894,466));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Sergeant Doherty";},function(){menu.inkStory.dailyMenuChosen("doherty");},894+64,466+128,ig.Font.ALIGN.CENTER,undefined));}
var fourthX=1098;var fourthY=466;if(show.hughes){options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.hughes,function(){menu.inkStory.dailyMenuChosen("hughes");},fourthX,fourthY));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Lt. Gerald Hughes";},function(){menu.inkStory.dailyMenuChosen("hughes");},fourthX+64,fourthY+128,ig.Font.ALIGN.CENTER,undefined));}
if(show.custer){options[menu.Page.MAIN].push(new ss.MenuImageOption(menu,this.images.custer,function(){menu.inkStory.dailyMenuChosen("custer");},fourthX,fourthY));options[menu.Page.MAIN].push(new ss.MenuOption(menu,function(){return"Officer Custer";},function(){menu.inkStory.dailyMenuChosen("custer");},fourthX+64,fourthY+128,ig.Font.ALIGN.CENTER,undefined));}
this.options=options;},update:function()
{this.parent();},draw:function()
{this.parent();}});});

// lib/game/inkstory.js
ig.baked=true;ig.module('game.inkstory').requires('impact.entity','plugins.ss.dialog','plugins.ss.ink','game.menu.daily').defines(function(){InkStory=ig.Class.extend({name:"Speech",ink:undefined,commonTextAction:undefined,commonChoiceAction:undefined,currentPortrait:undefined,portraitCache:{},currentBackground:undefined,dialogManager:undefined,dailymenu:undefined,backgroundCache:{},init:function(){if(ig.global.wm)return;this.ink=new ss.Ink(storyContent);var inkstory=this;this.commonTextAction=new ss.DialogAction(function(){if(inkstory.ink.isEnded()){this.setNextMoment(null);return inkstory.end();}
this.setNextMoment(inkstory.getNextMoment());});this.commonChoiceAction=new ss.DialogAction(function(choiceIndex){if(inkstory.ink.isEnded()){this.setNextMoment(null);return inkstory.end();}
this.setNextMoment(inkstory.getNextMoment(choiceIndex));});this.ink.tagHandlers["portrait"]=function(key,character,position){if(!position){if(character.toLowerCase()=="telegraph"){position="left";}else{position="center";}}
if(character==null||character=="none"){inkstory.currentPortrait=undefined;}else{inkstory.currentPortrait={character:character.toLowerCase(),position:position.toLowerCase()};}};this.ink.tagHandlers["background"]=function(key,name){inkstory.currentBackground=name==null||name=="none"?undefined:name;};this.ink.tagHandlers["music"]=function(key,title){if(title in ig.music.namedTracks){console.debug("🎵 "+title);}else{console.debug("🎵 ??"+title);return;}
if(ig.music.currentTrack!==ig.music.namedTracks[title])ig.music.play(title);};this.ink.tagHandlers["dailymenu"]=function(key,day){if(!inkstory.dailyMenuChosen("continue")){inkstory.dailymenu=new DailyMenu(inkstory,inkstory.ink.getChoices(),parseInt(day.replace(/day/,'')));}};this.dialogManager=new ss.DialogManager(this.getNextMoment());this.dialogManager.trigger();},dailyMenuChosen:function(option){var choices=this.ink.getChoices();for(var i=0;i<choices.length;i++){if(choices[i].toLowerCase().includes(option)){ss.GlobalDialogManager.dialogIsActive=true;this.dailymenu=undefined;this.dialogManager=new ss.DialogManager(this.getNextMoment(i));return true;}}
return false;},getNextMoment:function(choiceIndex){this.ink.continue(choiceIndex);var text=this.ink.getText();var sizedText="";var needNewline=false;for(var i=0;i<text.length;i++){sizedText+=text[i];if(i>61&&i%62===0){needNewline=true;}
if(needNewline){if(/[\s\.?!\-+=”"']/.test(text[i])&&!/[\s\.?!\-+=”"']/.test(text[i+1])){sizedText+='\n';needNewline=false;}else if(i!==text.length-1&&i>67&&i%68===0){if(/[\s\.?!\-+=”"']/.test(text[i])){sizedText+='\n';}else{sizedText+='-\n';}
needNewline=false;}}}
var choicesTexts=this.ink.getChoices();if(choicesTexts.length==0){var moment=new ss.DialogTextMoment(sizedText,undefined,this.commonTextAction);}else{var actions=[];for(var i=0;i<choicesTexts.length;i++){actions.push(this.commonChoiceAction);}
var moment=new ss.DialogChoiceMoment(sizedText,undefined,choicesTexts,actions);}
return moment;},end:function(){ig.game.fadeOutTimer=new ig.Timer(ig.game.fadeOutTime+0.1);setTimeout(function(){ig.game.loadMainMenu();ig.game.fadeInTimer=new ig.Timer(ig.game.fadeInTime);},ig.game.fadeOutTime*1000);},drawBG:function(){if(typeof(this.currentBackground)==="undefined"){ig.system.context.fillStyle='#fff';ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);}else{if(this.currentBackground in this.backgroundCache===false){this.backgroundCache[this.currentBackground]=new ig.Image('media/background/'+this.currentBackground+'.jpg');}
var cached=this.backgroundCache[this.currentBackground];if(typeof(cached)==="undefined"){console.error("Missing art for background: "+this.currentBackground);}else{cached.draw(0,0);}}},drawPortrait:function(){if(typeof(this.currentPortrait)==="undefined")return;if(this.currentPortrait.character in this.portraitCache===false){this.portraitCache[this.currentPortrait.character]=new ig.Image('media/portrait/'+this.currentPortrait.character+'.png');;}
var cached=this.portraitCache[this.currentPortrait.character];if(typeof(cached)==="undefined"){console.error("Missing art for portrait: "+this.currentPortrait.character);}else{cached.draw(this.getPortraitX(this.currentPortrait.position,cached.width),0);}},getPortraitX:function(position,width){switch(position){case"left":return 16;case"right":return ig.system.width-width-16;default:return(ig.system.width-width)/2;}},update:function(){if(this.dailymenu){this.dailymenu.update();}else if(this.dialogManager){this.dialogManager.update();}},draw:function(){this.drawBG();this.drawPortrait();if(this.dailymenu){this.dailymenu.draw();}else if(this.dialogManager){this.dialogManager.draw();}},trigger:function()
{if(this.dialogManager){this.dialogManager.trigger();}}});});

// lib/game/entities/ink-visual-novel.js
ig.baked=true;ig.module('game.entities.ink-visual-novel').requires('impact.entity','plugins.ss.random','plugins.ss.dialog','game.inkstory').defines(function(){EntityInkVisualNovel=ss.DialogManagedEntity.extend({_wmDrawBox:true,_wmBoxColor:'rgba(28, 230, 128, 0.7)',size:{x:32,y:32},name:"",dialogManager:undefined,init:function(x,y,settings){this.parent(x,y,settings);if(ig.global.wm)return;this.cutscene=new InkStory();},update:function(){this.parent();this.cutscene.update();},draw:function(){this.parent();this.cutscene.draw();},beingTriggered:false,trigger:function()
{this.cutscene.trigger();}});});

// lib/game/levels/blank.js
ig.baked=true;ig.module('game.levels.blank').requires('impact.image','game.entities.ink-visual-novel').defines(function(){LevelBlank={"entities":[{"type":"EntityInkVisualNovel","x":388,"y":92}],"layer":[]};});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('plugins.impact-splash-loader','impact.game','impact.font','plugins.ss.true-font','plugins.chrome-app','plugins.localstorage','game.colors','game.logos','game.menu.title','game.levels.blank').defines(function(){ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.M4A]
SwitchboardCopperGame=ig.Game.extend({musicEnabled:true,localStorage:new ig.localStorage(),menu:null,logos:new Logos(),fadeInTime:1,fadeOutTime:1,fadeInTimer:undefined,fadeOutTimer:undefined,music:{menu:new ig.Sound('media/music/Jahzzar - Airship Fury.*',false),hall1:new ig.Sound('media/music/Kevin MacLeod - Hall of the Mountain King - 1.*',false),hall2:new ig.Sound('media/music/Kevin MacLeod - Hall of the Mountain King - 2.*',false),hall3:new ig.Sound('media/music/Kevin MacLeod - Hall of the Mountain King - 3.*',false),hall4:new ig.Sound('media/music/Kevin MacLeod - Hall of the Mountain King - 4.*',false),hall5:new ig.Sound('media/music/Kevin MacLeod - Hall of the Mountain King - 5.*',false)},init:function(){for(var i in this.music){ig.music.add(this.music[i],i);}
ig.music.volume=1;ig.music.loop=true;this.setupDialogManager();ig.input.bind(ig.KEY.MOUSE1,'click');if(ig.ua.mobile){}else{this.setupDesktopControls();}
this.fadeInTimer=new ig.Timer(0);this.fadeOutTimer=new ig.Timer(0);this.logos.run(function(){ig.game.fadeInTimer=new ig.Timer(ig.game.fadeInTime);ig.game.loadMainMenu();setTimeout(function(){ig.music.play("menu");},400);},true);},setupDialogManager:function(){ss.GlobalDialogManager.fontName="Cavalcade";setTimeout(function(){ss.GlobalDialogManager.loadFont("Cavalcade","/fonts/Cavalcade/Cavalcade-Regular.css");},1);ss.GlobalDialogManager.textSize=36;ss.GlobalDialogManager.textEdgePadding=10;ss.GlobalDialogManager.textLinePadding=10;ss.GlobalDialogManager.outlineThickness=2;ss.GlobalDialogManager.choiceCursorPadding=30;ss.GlobalDialogManager.outlineColor=hexToRgbA(GameColors.DialogBGOutline);ss.GlobalDialogManager.bgColor=hexToRgbA(GameColors.DialogBG);ss.GlobalDialogManager.fontColor=hexToRgbA(GameColors.DialogFG);ss.GlobalDialogManager.minHeight=1000;},loadMainMenu:function()
{ig.music.fadeOut();this.menu=new TitleMenu();},setupDesktopControls:function(){ig.input.bind(ig.KEY.UP_ARROW,'up');ig.input.bind(ig.KEY.LEFT_ARROW,'left');ig.input.bind(ig.KEY.DOWN_ARROW,'down');ig.input.bind(ig.KEY.RIGHT_ARROW,'right');ig.input.bind(ig.KEY.SPACE,'primary');ig.input.bind(ig.KEY.BACKSPACE,'secondary');ig.input.bind(ig.KEY.ENTER,'pause');ss.GlobalDialogManager.selectButtons.push('primary');ss.GlobalDialogManager.cancelButtons.push('secondary');if(ig.system.isNMJSEnvironment)
{ig.input.bind(ig.KEY.F,'toggleFullscreen');ig.input.bind(ig.KEY.ESC,'exitPointerLock');ig.input.bind(ig.KEY.ESC,'exitFullscreen');}
else
{window.addEventListener("keydown",function(e){switch(e.which)
{case ig.KEY.F:ig.system.toggleFullscreen();break;case ig.KEY.ESC:if(ig.system.isFullscreen)document.exitFullscreen();break;}});}},startNewGame:function()
{ig.game.autoSort=true;ig.game.sortBy=ig.Game.SORT.POS_Y;this.fadeOutTimer=new ig.Timer(this.fadeOutTime);setTimeout(function(){if(location.search.length>0)ig.game.loadLevel(self["Level"+location.search.replace("?level=","")]);else ig.game.loadLevel(LevelBlank);ig.game.fadeInTimer=new ig.Timer(ig.game.fadeInTime);},ig.game.fadeOutTime*1000);},loadLevel:function(data)
{this.menu=null;this.parent(data);},update:function(){if(this.logos.isRunning)return;this.parent();if(this.menu)return this.menu.update();},draw:function(dialogDraw){if(this.logos.isRunning)return;if(this.menu){this.menu.draw();}else{this.parent();this.drawDialogManagedContent();}
if(this.fadeInTimer.delta()<0){var fadeAlpha=(1-(ig.game.fadeInTime+this.fadeInTimer.delta()))/ig.game.fadeInTime;ig.system.context.fillStyle='rgba(0,0,0,'+fadeAlpha+')';ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);}
if(this.fadeOutTimer.delta()<0){var fadeAlpha=(ig.game.fadeOutTime+this.fadeOutTimer.delta())/ig.game.fadeOutTime;ig.system.context.fillStyle='rgba(0,0,0,'+fadeAlpha+')';ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);}}});var fps=60;var gameWidth=720;var gameHeight=gameWidth*(16/9);var scale=1;ig.System.scaleMode=ig.System.SCALE.SMOOTH;ig.main('#canvas',SwitchboardCopperGame,fps,gameHeight,gameWidth,scale,ig.ImpactSplashLoader);});
